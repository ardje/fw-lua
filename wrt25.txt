root@wrt25:/etc/chains# ls
FORWARD     INPUT       awindows    copperjet   internet    private     weegschaal  wireless
root@wrt25:/etc/chains# grep . internet 
#!/bin/sh
. /etc/fw.inc
case "$1" in
        start)
                generic_start
                ;;
        rules)
                generic_forwarding ${IFWAN2}
                #generic_forwarding ${IFWAN2} ! --source 192.168.0.150
                # generic_forwarding ${IFWAN2} ! --destination 172.19.3.0/24
                ip6tables --table filter --append FORWARD --out-interface sixxs --jump internet
                ip6tables --table filter --append FORWARD --out-interface tun6to4 --jump internet
                iptables --table filter --append internet --in-interface ${IFLAN} --match mac --mac-source 00:21:5b:00:10:10 --jump weegschaal
#               iptables --table nat --append prerouting_rule --in-interface ${IFLAN} --proto tcp --match mac --mac-source 00:21:5b:00:10:10 --jump REDIRECT --to-ports 4097
#               iptables --table nat --append prerouting_rule --proto tcp --destination 83.247.63.155 --destination-port 4097 --jump REDIRECT --to-ports 4097
                iptables --table filter --append internet --in-interface ${IFLAN} --jump ACCEPT
                iptables --table filter --append internet --in-interface ${IFWIFI} --protocol tcp --destination-port 25 --jump DROP
                iptables --table filter --append internet --in-interface ${IFWIFI} --jump ACCEPT
                # INPUT RULES
                iptables --table filter --append input_rule --proto 41 --source 193.109.122.244 --jump ACCEPT
                iptables --table filter --append input_rule --proto 41 --source 217.196.41.9 --jump ACCEPT
                allow6
                ;;
        end)
                iptables --table filter --append internet --jump DROP
                ;;
esac
root@wrt25:/etc/chains# grep . private 
#!/bin/sh
. /etc/fw.inc
MAC_G1=00:18:41:ec:5f:bb
MAC_G1_2=00:18:41:e5:b0:0e
MAC_NB_0=6c:62:6d:17:ff:0d
MAC_LE=00:23:76:d7:2d:05
MAC_PD=00:19:94:0f:b2:96
case "$1" in
        start)
                generic_start
                ;;
        rules)
                generic_forwarding ${IFLAN}
                iptables --table filter --append private --in-interface ${IFLAN} --jump ACCEPT
                # DNS publiek
                dnatAPPA ${MY_WAN_IP} udp 53 192.168.0.64
                dnatAPPA ${MY_WAN_IP} tcp 53 192.168.0.64
                dnatAPPA ${MY_WAN_IP} tcp 51413 192.168.0.136
                dnatAPPA 192.168.1.34 udp 123 192.168.0.102
                dnatAPPA 192.168.9.2 tcp 5000 192.168.0.148 --match mac --mac-source 00:fd:07:94:12:8f
                dnatAPPA 192.168.9.2 tcp 5000 192.168.0.148 --match mac --mac-source 00:17:f2:49:82:fc
                dnatAPPA 192.168.9.2 tcp 22 192.168.0.148 --match mac --mac-source 00:05:7b:63:12:57
                dnatAPPA 192.168.9.2 tcp 22 192.168.0.148 --match mac --mac-source ${MAC_G1}
                dnatAPPA 192.168.9.2 tcp 25 192.168.0.130 --match mac --mac-source 00:1c:bf:8e:cb:90
                # # epc 700
                # dnatAPPA ${MY_WAN_IP} tcp 22 192.168.0.42 --match mac --mac-source 00:fd:07:94:12:8f
                # # letux 400
                # dnatAPPA ${MY_WAN_IP} tcp 22 192.168.0.42 --match mac --mac-source 00:05:7b:63:12:57
                # # G1
                # dnatAPPA ${MY_WAN_IP} tcp 22 192.168.0.42 --match mac --mac-source ${MAC_G1}
                # dnatAPPA ${MY_WAN_IP} tcp 22 192.168.0.42 --match mac --mac-source 00:24:7e:66:2e:a6
                for adev in $MAC_G1 $MAC_G1_2 $MAC_LE $MAC_PD $MAC_NB_0
                do
                allow --in-interface $IFWIFI --proto tcp --destination 192.168.0.14 --dport 8080 --match mac --mac-source ${adev}
                allow --in-interface $IFWIFI --proto udp --destination 192.168.0.14 --dport 9777 --match mac --mac-source ${adev}
                # dnatAPPA ${MY_WAN_IP} tcp 22 192.168.0.42 --match mac --mac-source ${adev}
                done
#               allow --in-interface $IFWIFI --destination 192.168.0.15 --match mac --mac-source 00:19:94:0f:b2:96
                allow --in-interface $IFWIFI --destination 192.168.0.16 --match mac --mac-source 00:19:94:0f:b2:96
                allow --in-interface $IFWIFI --destination 192.168.0.16 --match mac --mac-source $MAC_G1
                allow --in-interface $IFWIFI --destination 192.168.0.16 --match mac --mac-source $MAC_G1_2
                allow --proto tcp --dport 53 --destination 192.168.0.64/31
                allow --proto udp --dport 53 --destination 192.168.0.64/31
                allow --proto tcp --dport 53 --destination 192.168.0.96/31
                allow --proto udp --dport 53 --destination 192.168.0.96/31
                # IMAPS
                allow --proto tcp --dport 993 --destination 192.168.0.39/32
                allow --proto tcp --dport 8554 --destination 192.168.0.148/32
                #allow --proto udp --dport 123 --destination 192.168.0.102/32
                allow --proto udp --dport 123 --destination 192.168.0.100/32
                # dreambox
#               allow --proto tcp --dport 12000 --destination 192.168.0.15/32 --source 84.245.31.239/32 # dsl.nielsj.net
#               allow --proto tcp --dport 12000 --destination 192.168.0.15/32 --source 81.171.37.249/32 # cs.nielsj.net
#               allow --proto tcp --dport 12000 --destination 192.168.0.15/32 --source 82.72.150.6/32 # edp.wurtel.net
                drop --proto tcp --dport 12000 --destination 192.168.0.15/32
                for anIp in 178.33.60.14 199.204.248.102
                do
                        drop --source $anIp
                done
                drop --source 69.64.32.0/19 --destination 192.168.0.10
#               iptables -t nat -A prerouting_rule --destination ${MY_WAN_IP} -p tcp --dport 16001 -j DNAT --to 192.168.0.15:12000

#               dnatAPPA ${MY_WAN_IP} tcp 12000 192.168.0.15

                # SSMTP
                allow --proto tcp --dport 25 --destination 192.168.0.35/32
                for ip in 178.117.20.110 217.196.41.19 217.196.41.192 217.196.45.116 217.170.15.1 81.171.37.195;do 
                        allow --proto tcp --dport 22:23 --source $ip
                done
                iptables --table nat --append prerouting_rule --destination ${MY_WAN_IP} --proto tcp --dport 22 --jump DNAT --to-destination  192.168.0.242
                iptables --table nat --append prerouting_rule --destination ${MY_WAN_IP} --proto tcp --dport 23 --jump DNAT --to-destination  192.168.0.251:22
##              if true
#               then
#               # ASTERISK
                dnatAPPA ${MY_WAN_IP} udp 10000:20000 192.168.0.11
                dnatAPPA ${MY_WAN_IP} udp 5060 192.168.0.11
                dnatAPPA ${MY_WAN_IP} udp 4569 192.168.0.11
                dnatAPPA ${MY_WAN_IP} udp 4520 192.168.0.11
#               fi
#               dnatAPPA 62.216.22.210 udp 10000:20000 192.168.0.18
#               dnatAPPA 62.216.22.210 udp 5060 192.168.0.18
#               dnatAPPA 62.216.22.210 udp 5060 192.168.0.18
#               dnatAPPA 62.216.22.210 udp 4569 192.168.0.18
#               dnatAPPA 62.216.22.210 udp 4520 192.168.0.18
                dnatAPPA ${MY_WAN_IP} tcp 6881:6889 192.168.0.148

                # EMAIL
                dnatAPPA ${MY_WAN_IP} tcp 25 192.168.0.250
                # OUDE WEBSITES
                dnatAPPA ${MY_WAN_IP} tcp 80 192.168.0.69
                # SSL
                dnatAPPA ${MY_WAN_IP} tcp 443 192.168.0.69
                allow --in-interface $IFWIFI --proto udp --dport 67
                allow --in-interface $IFWIFI --proto udp --dport 68
                allow --in-interface $IFWIFI --proto tcp --dport 631 --destination 192.168.0.185
                allow6 --proto icmp
                allow6 --proto icmpv6
                allow6 --proto tcp --dport 22 --source 2a02:310:0:1012::/64
                allow6 --proto tcp --dport 22 --source 2a02:310:0:1013::/64
                allow6 --proto tcp --dport 22 --source 2a02:10:100::209/128
                allow6 --proto tcp --dport 22 --source 2001:7b8:32d::/60
                allow6 --proto tcp --dport 22 --source 2001:7f8:13::a500:5418:1/128
                allow6 --proto tcp --dport 25 --destination 2001:7b8:32d::4
                allow6 --proto tcp --dport 80 --destination 2001:7b8:32d::0/124
                drop6 --proto tcp --dport 2049 --destination 2001:7b8:32d::0/64
                drop6 --proto udp --dport 2049 --destination 2001:7b8:32d::0/64
                allow6 --proto tcp --dport 51434 --destination 2001:7b8:32d:0:224:1dff:fe7f:4088
                allow6 --proto tcp  ! --syn --dport 1024:65535 --destination 2001:7b8:32d::0/64
                allow6 --proto udp --dport 1024:65535 --destination 2001:7b8:32d::0/64
                iptables --table filter --append input_rule --in-interface ${IFLAN} --jump ACCEPT
                ;;
        end)
                iptables --table filter --append ${self} --jump DROP
                ;;
esac




